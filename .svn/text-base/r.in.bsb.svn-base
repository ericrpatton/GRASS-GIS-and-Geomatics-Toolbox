#! /bin/sh
#
############################################################################
#
# MODULE:        r.in.bsb for Grass 6.0/6.1
# 
# AUTHOR(S):   	 Eric Patton
# 
# PURPOSE:       To allow the inport of NOAA bsb charts into Grass raster format. 
# 
# COPYRIGHT:     (C) 2006 by the GRASS Development Team
#
#                This program is free software under the GNU General Public
#                License (>=v2). Read the file COPYING that comes with GRASS
#                for details.
# 
# Last Modified: March 30, 2006
#
#############################################################################

#%Module
#% description: NOAA bsb to Grass raster import utility
#%END

#%option
#% key: input
#% type: string
#% required: yes
#% description: Input bsb filename or wildcard seach pattern for multiple imports
#%END

#%option
#% key: output
#% type: string
#% required: no
#% description: Name of output tif (no extension necessary)
#%END


# Check to see if we're in Grass.
if  [ -z "$GISBASE" ] ; then
    echo "You must be in GRASS GIS to run this program." >2&1
    exit 1
fi

if [ "$1" != "@ARGS_PARSED@" ] ; then
     exec g.parser "$0" "$@"
fi

SCRIPT=`basename $0`

# Setup clean exit for Ctrl-C or similar breaks.
trap 'echo -e "\n\nUser break or similar caught; Exiting.\n" ; exit 1' 2 3 15

INPUT="$GIS_OPT_input"
OUTPUT="$GIS_OPT_output"

if [ -z "$OUTPUT" ] ; then
	OUTPUT="$INPUT"
fi


gdal_translate -of GTiff ${INPUT} ${OUTPUT}.tif
gdalwarp -s_srs EPSG:4326 -t_srs EPSG:32620 -of GTiff ${OUTPUT}.tif  

GRASS_INPUT=${OUTPUT}.utm20.tif

r.in.gdal input=${GRASS_INPUT} output=${OUTPUT}


echo -e "\nDone importing $INPUT."

rm -f ${OUTPUT}.utm20.tif ${OUTPUT}.tif

exit 0








